install.packages("mongolite")
library(mongolite)
connection_string = 'mongodb+srv://chamanthabk:chamantha19@comp2031-8031.uiwqidv.mongodb.net/?retryWrites=true&w=majority'
sales_collection = mongo(collection="sales", db="sample_supplies", url=connection_string)
sales_collection$count()
data <- sales_collection$find()
head(data)
db.sales.find({returned: {$ne: true}})
any(is.na(data))
data_clean <- na.omit(data)
view(data_clean)
View(data_clean)
View(data_clean[[2]][[149]])
print(data_clean)
missing_phone = sales_collection.count_documents({"customer.phone": {"$exists": False}})
data.count_documents({"customer.phone": {"$exists": False}})
data.find({ "customer.phone": { $exists: false } })
View(data_clean)
library(tidyverse)
sales_data <- sales_collection$find()
View(data_clean)
sales_data <- sales_collection$find()
sales_tibble <- as_tibble(sales_data)
print(sales_tibble)
View(sales_tibble)
null_counts <- colSums(is.na(sales_tibble))
print(null_counts)
mongo_connection <- mongo(collection = "sales", db = "sample_supplies")
mongo_connection <- mongo(collection = "sales", db = "sample_supplies")
customer_ids <-sales_collection$find(fields = '{"customer_id": 1}')
print(customer_ids)
View(sales_tibble)
library(dplyr)
sales_tibble <- tibble(
product = c("A", "B", "A", "C"),
quantity = c(10, 5, 8, 2)
)
sales_tibble <- sales_tibble %>% mutate(customer_id = c(1, 2, 3, 4))
print(sales_tibble)
View(sales_tibble)
View(data_clean)
View(data)
View(data_clean)
View(data_clean[[2]][[1]])
View(data_clean[[2]][[2]])
View(data_clean[[2]][[3]])
View(data_clean[[2]][[3]])
View(data_clean[[2]][[6]])
sales_data <- sales_collection$find()
sales_data <- sales_collection$find()
View(sales_data)
customer_ids <- vector()
for(i in 1:nrow(sales_data)) {
customer_id <- mongo_con$find('{"_id": ObjectId("'
paste(sales_data[i,"customer_id"])
for(i in 1:nrow(sales_data)) {
customer_id <- sales_collection$find('{"_id": ObjectId("'
paste(sales_data[i,"customer_id"])
for(i in 1:nrow(sales_data)) {
customer_id <- sales_collection$find(paste0('{"_id": ObjectId("',
sales_data[i,"customer_id"],
'")}'
),
fields = '{"_id": false, "first_name": false, "last_name": false, "email": false}')
customer_ids <- c(customer_ids, customer_id$customer_id)
}
for(i in 1:nrow(sales_data)) {
customer_id <- sales_collection$find(paste0('{"_id": ObjectId("',
as.character(sales_data[i,"customer_id"]),
'")}'
),
fields = '{"_id": false, "first_name": false, "last_name": false, "email": false}')
customer_ids <- c(customer_ids, customer_id$customer_id)
}
for(i in 1:nrow(sales_data)) {
customer_id <- sales_collection$find(paste0('{"_id": ObjectId("',
as.character(sales_data[i,"customer_id"]),
'")}'
),
fields = '{"_id": false, "first_name": false, "last_name": false, "email": false}')
customer_ids <- c(customer_ids, customer_id$customer_id)
}
customer_id <- sales_collection$find(paste0('{"_id": ObjectId("', sales_data[i,"customer_id"], '") }'), fields = '{"_id": false, "first_name": false, "last_name": false, "email": false}').
customer_id <- sales_collection$find(paste0('{"_id": ObjectId("', sales_data[i,"customer_id"], '") }'), fields = '{"_id": false, "first_name": false, "last_name": false, "email": false}')
customer_ids <- vector()
for(i in 1:nrow(sales_data)) {
if(nchar(as.character(sales_data[i, "customer_id"])) > 0) {
customer_id <- sales_collection$find(
paste0('{"_id": ObjectId("', as.character(sales_data[i, "customer_id"]), '") }'),
fields = '{"_id": false, "first_name": false, "last_name": false, "email": false}'
)
customer_ids <- c(customer_ids, customer_id$customer_id)
}
}
for (i in 1:nrow(sales_data)) {
if (nchar(as.character(sales_data[i, "customer_id"])) > 0) {
customer_id <- sales_collection$find(paste0('{"_id": ObjectId("',
as.character(sales_data[i, "customer_id"]),
'")}'
),
fields = '{"_id": false, "first_name": false, "last_name": false, "email": false}')
customer_ids <- c(customer_ids, customer_id$customer_id)
}
}
for(i in 1:nrow(sales_data)) {
if (!is.na(sales_data[i, "customer_id"]) && !is.null(sales_data[i, "customer_id"])) {
customer_id <- sales_collection$find(paste0('{"_id": ObjectId("',
as.character(sales_data[i,"customer_id"]),
'")}'
),
fields = '{"_id": false, "first_name": false, "last_name": false, "email": false}')
customer_ids <- c(customer_ids, customer_id$customer_id)
}
}
View(sales_data)
View(customer_ids)
customer_ids <- vector()
for(i in 1:nrow(sales_data)) {
if(!is.na(sales_data[i, "customer_id"])) {
customer_id <- sales_collection$find(paste0('{"_id": ObjectId("',
as.character(sales_data[i,"customer_id"]),
'")}'
),
fields = '{"_id": false, "first_name": false, "last_name": false, "email": false}')
customer_ids <- c(customer_ids, customer_id$customer_id)
}
}
customer_ids <- c()
for (i in 1:nrow(sales_data)) {
# check if customer_id is not empty
if (nchar(as.character(sales_data[i, "customer_id"])) > 0) {
# retrieve the customer id from the customers collection
customer_id <- customers_collection$find_one(
paste0('{"_id": ObjectId("', sales_data[i, "customer_id"], '")}'),
fields = '{"_id": false, "customer_id": true}'
)$customer_id
# append the customer id to the vector
customer_ids <- c(customer_ids, customer_id)
} else {
# if customer_id is empty, assign NA to customer_ids vector
customer_ids <- c(customer_ids, NA)
}
}
for(i in 1:nrow(sales_data)) {
if (nchar(as.character(sales_data[i, "customer_id"])) > 0) {
customer_id <- sales_collection$find(paste0('{"_id": ObjectId("',
as.character(sales_data[i,"customer_id"]),
'")}'
),
fields = '{"_id": false, "first_name": false, "last_name": false, "email": false}')
customer_ids <- c(customer_ids, customer_id$customer_id)
}
else {
customer_ids <- c(customer_ids, NA)
}
}
for (i in 1:nrow(sales_data)) {
if (nchar(as.character(sales_data[i, "customer_id"])) > 0) {
customer_id <- sales_collection$find(paste0('{"_id": ObjectId("',
as.character(sales_data[i,"customer_id"]),
'")}'
),
fields = '{"_id": false, "first_name": false, "last_name": false, "email": false}')
customer_ids[i] <- customer_id$customer_id
}
else {
customer_ids[i] <- NA
}
}
for(i in 1:nrow(sales_data)) {
if (!is.na(sales_data[i,"customer_id"]) && nchar(as.character(sales_data[i,"customer_id"])) > 0) {
customer_id <- customer_collection$find(paste0('{"_id": ObjectId("',
as.character(sales_data[i,"customer_id"]),
'")}'
),
fields = '{"_id": false, "first_name": false, "last_name": false, "email": false}')
customer_ids <- c(customer_ids, customer_id$customer_id)
} else {
customer_ids <- c(customer_ids, NA)
}
}
for(i in 1:nrow(sales_data)) {
if (complete.cases(sales_data[i, "customer_id"])) {
customer_id <- sales_collection$find(paste0('{"_id": ObjectId("',
as.character(sales_data[i,"customer_id"]),
'")}'
),
fields = '{"_id": false, "first_name": false, "last_name": false, "email": false}')
customer_ids <- c(customer_ids, customer_id$customer_id)
}
}
dim(sales_data)
rows_with_na <- which(!complete.cases(sales_data))
any(!complete.cases(sales_data))
complete.cases(sales_data[ , "customer_id"])
colnames(sales_data)
names(sales_data)
sales_data$customer_id <- ifelse(!is.na(sales_data$customer), sales_data$customer$id, NA)
View(sales_data)
library(dplyr)
sales_data_tibble <- as_tibble(sales_data)
view(sales_data_tibble)
View(sales_data_tibble)
view(data)
View(data)
sales_data <- sales_collection$find('{}', fields = '{"_id": 1, "customer_id": 1, "order_total": 1}')
View(sales_data)
data_clean <- left_join(data_clean, sales_data %>%
select(customer_id, sales_id),
by = "customer_id")
data_clean <- left_join(data_clean, sales_data %>%
select(_id, sales_id),
data_clean <- left_join(data_clean, sales_data %>% select(_id, customer_id), by = "_id")
data_clean <- left_join(data_clean, sales_data %>% select(_id, customer_id), by = "customer_id")
data_clean <- data_clean %>%
mutate(_id = sales_data$_id)
library(dplyr)
data_clean <- data_clean %>% mutate(_id = sales_data$_id)
data_clean$Added <- sales_data
data_clean %>% rename(Added_id = id)
View(data_clean)
data_clean %>% rename(Added = id)
data_clean %>% rename(Added_id = id)
data_clean <- data_clean %>% rename(customer_id = Added)
data_clean <- data_clean %>%
mutate(customer_id = str_replace(customer_id, "_id", ""))
data_clean <- data_clean %>%
mutate(customer_id = str_replace(customer_id, "$_id", ""))
rlang::last_trace()
data_clean$<- sales_data
data_clean$id<- sales_data
data_clean <- data_clean %>%
select(-id)
data_clean$customer_id <- sales_data$`_id`
View(data_clean[[2]][[1]])
View(data_clean[[2]][[1]])
View(data_clean[[2]][[1]])
View(data_clean[[2]][[25]])
View(data_clean[[2]][[1]])
data_clean <- data_clean %>%
select(customer_id, everything())
data_clean <- data_clean %>%
select(saleDate, customer_id, everything())
View(data_clean[[3]][[1]])
View(data_clean[[3]][[1]])
data_clean %>%
unnest(items)
library(tidyr)
library(dplyr)
data_clean %>%
unnest(items)
null_counts <- colSums(is.na(data_clean))
print(null_counts)
is_duplicate <- duplicated(data_clean)
print(is_duplicate)
is_missing <- is.na(data_clean)
print(is_missing)
num_duplicates <- sum(is_duplicate)
print(num_duplicates)
num_missing <- sum(is_missing)
print(num_missing)
View(data_clean[[3]][[1]])
View(is_missing)
View(data_clean)
sales_arrange1 <- sales_clean %.% arrange(customer_age)
sales_arrange1 <- sales_clean %>% arrange(customer_age)
library(dplyr)
data_clean_arranged <- data_clean %>% arrange(customer_age)
names(data_clean)
data_clean_arranged <- data_clean %>% arrange(customer)
View(data_clean_arranged)
View(data_clean_arranged[[3]][[1]])
total_amount_spent <- data_clean %>%
group_by(customer_id) %>%
summarise(Total = sum(price, na.rm = TRUE)) %>%
as_tibble()
data_clean_unnested <- data_clean %>%
unnest(items)
library(tidyr)
library(dplyr)
data_clean_unnested <- data_clean %>%
unnest(items)
total_amount_spent <- data_clean_unnested %>%
group_by(customer_id) %>%
summarise(Total = sum(price, na.rm = TRUE)) %>%
as_tibble()
install.packages("tidyverse")
library(tidyverse)
data_clean_unnested <- data_clean %>%
unnest(items)
total_amount_spent <- data_clean_unnested %>%
group_by(customer_id) %>%
summarise(Total = sum(price, na.rm = TRUE)) %>%
as_tibble()
View(total_amount_spent)
View(data_clean)
highest_amount_paid_by_customer <- total_amount_spent %>%
top_n(1, Total)
View(highest_amount_paid_by_customer)
sales_location <- data_clean %>%
group_by(store_location) %>%
summarise(Total_Sales = n())
sales_location_city <- data_clean %>%
group_by(store_location) %>%
summarise(Total_Sales = n())
names(data_clean)
sales_location_city <- data_clean %>%
group_by(store_Location) %>%
summarise(Total_Sales = n())
total_amount_spent <- total_amount_spent %>%
left_join(data_clean[, c("customer_id", "store_location")], by = "customer_id")
colnames(data_clean)
total_amount_spent <- total_amount_spent %>%
left_join(data_clean[, c("customer_id", "storeLocation")], by = "customer_id")
View(total_amount_spent)
store_sales <- data_clean %>%
group_by(storeLocation) %>%
summarise(total_sales = sum(total_amount), .groups = 'drop')
data_clean <- data_clean %>%
unnest(items)
data_clean <- data_clean %>%
group_by(saleDate, customer_id, storeLocation) %>%
summarise(total_amount = sum(price, na.rm = TRUE), .groups = 'drop')
store_sales <- data_clean %>%
group_by(storeLocation) %>%
summarise(total_sales = sum(total_amount, na.rm = TRUE), .groups = 'drop')
max_sales_location <- store_sales %>%
arrange(desc(total_sales)) %>%
slice(1)
View(max_sales_location)
store_sales <- total_amount_spent %>%
group_by(storeLocation) %>%
summarise(total_spent = sum(total_amount_spent, na.rm = TRUE), .groups = 'drop')
str(total_amount_spent)
total_spent_by_store <- total_amount_spent %>%
group_by(storeLocation) %>%
summarise(total_spent = sum(Total, na.rm = TRUE))
View(total_spent_by_store)
View(total_spent_by_store)
View(total_amount_spent)
View(total_amount_spent)
View(total_spent_by_store)
View(max_sales_location)
git init
